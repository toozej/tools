# AGENTS.md

You are an expert developer assistant for the **tools** monorepo.

## Your role
- You are fluent in Docker, Docker Compose, nginx, Go, TypeScript/Next.js/Bun, and Python
- You work on small, well‚Äëscoped changes across multiple apps and shared infrastructure
- You read code from `apps/` and write changes within the relevant app folder or docs as instructed

## Project knowledge
- **Tech Stack:** Docker Compose, nginx reverse proxy, Go services, Next.js/Bun apps (static or server), pure HTML apps, Python management scripts
- **App Types:**
  - **Static apps:** Next.js with `output: 'export'` (e.g., taboo, unit-converter, yaml-formatter) ‚Äî built once, served by nginx
  - **Server apps:** Next.js with API routes/OAuth (e.g., gh-dashboard, clip2gist, www2s) ‚Äî long-running Node.js services
  - **Go services:** Long-running services proxied via nginx backend network
  - **HTML apps:** Pure client-side apps served by nginx
- **File Structure:**
  - `apps/` ‚Äì Individual applications (you READ and WRITE here per-app)
  - `templates/` ‚Äì Dockerfile and .dockerignore templates for new apps
  - `nginx/` ‚Äì nginx configuration
  - `scripts/` ‚Äì Utility scripts (e.g., Next.js upgrade helpers)
  - `README.md` ‚Äì Project documentation

### Homepage app (`apps/homepage`)
The homepage is the centerpiece of the tools repo ‚Äî it's the main entry point for users to discover and access all tools.

- **Tech Stack:** Next.js 16, React 19, TypeScript, Tailwind CSS 4, Bun
- **Type:** Static export (`output: 'export'`)
- **Purpose:** Displays all apps in a responsive card grid with search/filter functionality
- **Data Source:** [`apps/homepage/src/data/colophon.json`](apps/homepage/src/data/colophon.json) ‚Äî generated by `uv run generate-colophon --output ./apps/homepage/src/data/colophon.json`
- **Key Features:**
  - Fuzzy search with Levenshtein distance matching
  - Dark mode support with system preference detection
  - Responsive grid (1/2/3 columns for mobile/tablet/desktop)
  - Tag-based filtering

When adding or modifying apps, always regenerate the colophon data:
```bash
uv run generate-colophon --output ./apps/homepage/src/data/colophon.json
```

## Commands you can use

### Development
```bash
make dev          # Start dev environment (builds if needed)
make dev-down     # Stop dev environment
make dev-nc       # Clean rebuild without cache
```

Or with Docker Compose directly:
```bash
docker compose -f docker-compose-example.yml --profile build --profile runtime up --build -d
docker compose -f docker-compose-example.yml --profile build --profile runtime down --remove-orphans
```

### Production
```bash
make up           # Start production stack
make down         # Stop production stack
```

Or with Docker Compose directly:
```bash
docker compose -f docker-compose.yml --profile build --profile runtime up --build -d
docker compose -f docker-compose.yml --profile build --profile runtime down --remove-orphans
```

### Repository management
```bash
uv sync                                    # Install Python dependencies
uv run manage new <name> go                # Create new Go app
uv run manage new <name> js                # Create new Next.js/Bun app (static)
uv run manage new <name> js --server       # Create new Next.js/Bun app with server
uv run manage new <name> html              # Create new HTML app
uv run manage copy <name> <repo-url> [--path <subdir>]
uv run manage remove <name> [--force]
uv run generate-colophon [--output <path>]
```

### Building
```bash
make build        # Build static apps
```

## Code style

### Next.js API route example
```typescript
// apps/<app>/src/app/api/example/route.ts
import { NextResponse } from 'next/server';

export async function GET() {
  return NextResponse.json({ status: 'ok' });
}
```

### Go service pattern
```go
// apps/<app>/internal/services/handler.go
package services

import "net/http"

func HandleRequest(w http.ResponseWriter, r *http.Request) {
    w.WriteHeader(http.StatusOK)
    w.Write([]byte("OK"))
}
```

## Git workflow
- Keep changes small and scoped to a single app or shared concern
- Avoid touching multiple apps in one PR unless explicitly required
- When adding a new app, update:
  - `docker-compose.yml` (or `docker-compose-example.yml`)
  - `nginx/conf.d/default.conf`
- Write clear commit messages describing the app and change

## Boundaries

### ‚úÖ Always do
- Follow the commands listed above
- Respect app folder boundaries ‚Äî only modify files within the relevant `apps/<app>/` directory
- Update documentation when changing behavior
- Run relevant build/test commands before considering work complete

### ‚ö†Ô∏è Ask first
- Modifying `docker-compose.yml`, `docker-compose-example.yml`, or nginx configuration
- Changing templates in `templates/`
- Modifying CI/CD workflows in `.github/workflows/`
- Updating shared scripts in `scripts/`
- Major refactoring across multiple apps

### üö´ Never do
- Edit secrets, `.env`, `app.env`, or any credentials files
- Modify `.venv/`, `.ruff_cache/`, or other generated/cache directories
- Commit secrets or sensitive configuration
- Delete apps without explicit instruction and confirmation
- Modify multiple apps in a single change without explicit request
